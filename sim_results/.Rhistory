bg_table1 <- highlight_cells(df_sum_tidy[,-1], small_better_rows = c(1,4))
# Expand to a matrix to match table shape
border_matrix <- matrix(rep(border_colors, each = 2), nrow = 7, ncol = 2, byrow = TRUE)
lwd_matrix <- matrix(1, nrow = 7, ncol = 2)
lwd_matrix[5:7, ] <- 4
fontface_matrix <- matrix("plain", nrow = 7, ncol = 2)
for (k in 5:7) {
j <- which.max(df_sum_tidy[k, -1])  # column with largest value
fontface_matrix[k, j] <- "bold"
}
blue_theme <- ttheme_default(
core = list(fg_params = list(
fontface =as.vector(fontface_matrix)),
bg_params = list(fill=as.vector(bg_table1),
col = as.vector(border_matrix),lwd  = as.vector(lwd_matrix))),
#,colhead = list(bg_params = list(fill = "blue", col = NA))
colhead = list(
fg_params = list(fontface = "bold"),         # bold headers
bg_params = list(fill = "white", col = "white")  # white fill + black border
)
)
table1 <- tableGrob(df_sum_tidy[,-1], rows = c("(1) DLT rate", "(2) Response rate", "(3a) Sufficient intensity rate", "(3b) Expected symptom bother", expression(atop(bold("Rank prioritising DLTs:"), "Probability dose selected `best`:")),
expression(atop(bold("Rank with intermediate ties:"), "Probability dose selected `best`:")), expression(atop(bold("Rank prioritising response:"), "Probability dose selected `best`:"))),theme = blue_theme)
p <- ggplot() + xlim(0, 4) + ylim(0, 4) + theme_void()
fig2<- p + annotation_custom(table1, xmin = 0, xmax = 4, ymin = 0, ymax = 4) +ggtitle(paste0("Scenario ",i))+
theme(
plot.title = element_text(
hjust = 0.2,
vjust = 1,
size = 16,
face = "bold"
),
plot.margin = unit(c(2, 1, 1, 1), "cm")
)
fig2
fig<-plot_grid(fig2, density, ncol = 2, rel_widths = c(1, 1.3))
pdf(file.path(paste0("sim_results/scenario", i), paste0("plot_scenario", i, ".pdf")), width=10, height=5)
tryCatch({
print(fig)
}, finally = {
dev.off()
})
assign(paste0("figure", i), fig)
}
pdf(file.path(paste0("figures"), paste0("simulation_figure.pdf")), width=10, height=15)
print(plot_grid(figure4, figure4, figure4, figure4, ncol = 1))
dev.off()
pdf(file.path(paste0("figures"), paste0("simulation_figure.pdf")), width=10, height=15)
print(plot_grid(figure1, figure2, figure3, figure4, ncol = 1))
dev.off()
pdf(file.path(paste0("figures"), paste0("simulation_figure.pdf")), width=10, height=18)
print(plot_grid(figure1, figure2, figure3, figure4, ncol = 1))
dev.off()
setwd("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio")
source("functions.R")
source("figure_sourcefile.R")
set.seed(11600)
bg_table1 <- highlight_cells(df_sum_tidy[,-1], small_better_rows = c(1,4))
# Expand to a matrix to match table shape
border_matrix <- matrix(rep(border_colors, each = 2), nrow = 7, ncol = 2, byrow = TRUE)
lwd_matrix <- matrix(1, nrow = 7, ncol = 2)
lwd_matrix[5:7, ] <- 4
fontface_matrix <- matrix("plain", nrow = 7, ncol = 2)
for (k in 5:7) {
j <- which.max(df_sum_tidy[k, -1])  # column with largest value
fontface_matrix[k, j] <- "bold"
}
blue_theme <- ttheme_default(
core = list(fg_params = list(
fontface =as.vector(fontface_matrix)),
bg_params = list(fill=as.vector(bg_table1),
col = as.vector(border_matrix),lwd  = as.vector(lwd_matrix))),
#,colhead = list(bg_params = list(fill = "blue", col = NA))
colhead = list(
fg_params = list(fontface = "bold"),         # bold headers
bg_params = list(fill = "white", col = "white")  # white fill + black border
)
)
table1 <- tableGrob(df_sum_tidy[,-1], rows = c("(1) DLT rate", "(2) Response rate", "(3a) Sufficient intensity rate", "(3b) Expected symptom bother", expression(atop(bold("Rank prioritising DLTs:"), "Probability dose selected `best`:")),
expression(atop(bold("Rank with intermediate ties:"), "Probability dose selected `best`:")), expression(atop(bold("Rank prioritising response:"), "Probability dose selected `best`:"))),theme = blue_theme)
p <- ggplot() + xlim(0, 4) + ylim(0, 4) + theme_void()
fig2<- p + annotation_custom(table1, xmin = 0, xmax = 4, ymin = 0, ymax = 4) +ggtitle(paste0("Scenario ",i))+
theme(
plot.title = element_text(
hjust = 0.2,
vjust = 1,
size = 16,
face = "bold"
),
plot.margin = unit(c(2, 1, 1, 1), "cm")
)
fig2
setwd("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio")
source("functions.R")
source("figure_sourcefile.R")
set.seed(11600)
#fixed for simulations
n.sim<-5000
n.sample_vec<- c(30,30)
correlation_pro_exp<- -0.6
correlation_pro_dlt<- 0.5
exposure_threshold<- 0.8
#vary across simulations
mat_dlt_rate<-t(matrix(c(0.27,0.42,0.27,0.27,0.2,0.45, 0.27, 0.27), nrow=2))
mat_efficacy_rate<-t(matrix(c(0.38, 0.38, 0.38, 0.60, 0.2, 0.6, 0.38, 0.38), nrow=2))
mat_dlt_efficacy<-t(matrix(c(0.3, 0.3, 0.3, 0.5, 0.1, 0.5, 0.3, 0.3), nrow=2))
mat_exposure_shape<- t(matrix(rep(9, times=8), nrow=2))
mat_exposure_rate<-t(matrix(c(1,2,1,1,1,2,1,2), nrow=2))
pro_scenario <- list()
pro_scenario[[1]]<-matrix(c(0.16, 0.23, 0.37, 0.18, 0.07, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[2]]<-matrix(c(0.059, 0.029, 0.265, 0.382, 0.265, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[3]]<-matrix(c(0.059, 0.029, 0.265, 0.382, 0.265, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[4]]<-matrix(c(0.16, 0.23, 0.37, 0.18, 0.07, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
fact_score <- abind(pro_scenario, along = 3)
for (i in 1:4){
vec_dlt_rate<- mat_dlt_rate[i,]
overall_efficacy<- mat_efficacy_rate[i,]
dlt_efficacy<- mat_dlt_efficacy[i,]
vec_exposure_shape<- mat_exposure_shape[i,]
vec_exposure_rate<- mat_exposure_rate[i,]
mat_fact<- fact_score[,,i]
sim_input <- list(
n.sim,
n.sample_vec,
correlation_pro_exp,
correlation_pro_dlt,
exposure_threshold,
vec_dlt_rate,
overall_efficacy,
dlt_efficacy,
vec_exposure_shape,
vec_exposure_rate,
mat_fact
)
saveRDS(sim_input, file = paste0("sim_results/scenario", i,"/simulation_inputs_scenario",i))
test<-replicate(n.sim,
analysis(n.sample_vec, vec_dlt_rate, overall_efficacy, dlt_efficacy , correlation_pro_exp, correlation_pro_dlt,
vec_exposure_shape, vec_exposure_rate, mat_fact,  exposure_threshold),
simplify = FALSE)
response_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["response"]])))
dlt_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["dlt"]])))
tie_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["tie"]])))
colnames(response_priority)<- c("doseA", "doseB", "tie")
colnames(dlt_priority)<- c("doseA", "doseB", "tie")
colnames(tie_priority)<- c("doseA", "doseB", "tie")
write.csv(response_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_response_priority_scenario", i, ".csv")))
write.csv(dlt_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_dlt_priority_scenario", i, ".csv")))
write.csv(tie_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_tie_priority_scenario", i, ".csv")))
wr_response_priority<-sapply(1:n.sim, function (k) response_priority[k,1]/response_priority[k,2])
wr_dlt_priority<-sapply(1:n.sim, function (k) dlt_priority[k,1]/dlt_priority[k,2])
wr_tie_priority<-sapply(1:n.sim, function (k) tie_priority[k,1]/tie_priority[k,2])
wr<-cbind(wr_response_priority,wr_dlt_priority,wr_tie_priority)
write.csv(wr, file = file.path(paste0("sim_results/scenario", i), paste0("wr_scenario", i, ".csv")))
#######CREATE FIGURE ########
df <- bind_rows(
data.frame(value = wr_response_priority, type = "response_priority"),
data.frame(value = wr_dlt_priority, type = "dlt_priority"),
data.frame(value = wr_tie_priority, type = "tie_priority"),
)
empirical<- df%>%group_by(type)%>%summarise(mean(value<=1))
colnames(empirical)<- c("priority", "prob_dose_a")
empirical[1,1]<- "dlt"
empirical[2,1]<- "response"
empirical[3,1]<- "tie"
# Plot densities
density<-ggplot(df, aes(x = value, color = type)) +
geom_density(size = 1.2) +  # Density lines
xlim(0, 4) +
labs(title = " ", x = "Win Ratio", y = "Density", colour="Rank") +
theme_minimal() +
geom_vline(xintercept = 1, linetype = "dotted", color = "black", size = 0.8)+
scale_color_manual(values = c("response_priority" = "steelblue3", "dlt_priority" = "red3", "tie_priority"="darkgoldenrod2"))+
theme(
legend.position = "none",
legend.background = element_rect(fill = alpha("white", 0.6)),  # semi-transparent background
legend.title = element_text(face = "bold")
)+coord_cartesian(clip = "off")+
annotate("segment", x = 1, xend = 0, y = -0.15, yend = -0.15,
arrow = arrow(length = unit(0.2, "cm")), color = "black") +
annotate("text", x = 0.2, y = -0.08, label = "Win ratio favours Dose A", hjust = 0.5) +
annotate("segment", x = 1, xend = 4, y = -0.15, yend = -0.15,
arrow = arrow(length = unit(0.2, "cm")), color = "black") +
annotate("text", x = 1.8, y = -0.08, label = "Win ratio favours Dose B", hjust = 0.5)+ expand_limits(y = -0.3)
density
df_sum <- data.frame(
dose = c("Dose A", "Dose B"),
prob_no_DLT = round(vec_dlt_rate,2),
prob_response = round(overall_efficacy,2),
prob_inten = round(c(1-pbeta(0.8, vec_exposure_shape[1], vec_exposure_rate[1]),
1-pbeta(0.8, vec_exposure_shape[2], vec_exposure_rate[2])),2),
exp_fact = round(c(sum(mat_fact[1,]*(1:5)), sum(mat_fact[2,]*(1:5))),2),
dlt = round(c(empirical$prob_dose_a[1], 1-empirical$prob_dose_a[1]),2),
tie = round(c(empirical$prob_dose_a[3], 1-empirical$prob_dose_a[3]),2),
response = round(c(empirical$prob_dose_a[2], 1-empirical$prob_dose_a[2]),2)
)
df_sum_tidy <- df_sum %>%
pivot_longer(-dose, names_to = "Metric", values_to = "Value") %>%
pivot_wider(names_from = dose, values_from = Value)
bg_table1 <- highlight_cells(df_sum_tidy[,-1], small_better_rows = c(1,4))
# Expand to a matrix to match table shape
border_matrix <- matrix(rep(border_colors, each = 2), nrow = 7, ncol = 2, byrow = TRUE)
lwd_matrix <- matrix(1, nrow = 7, ncol = 2)
lwd_matrix[5:7, ] <- 4
fontface_matrix <- matrix("plain", nrow = 7, ncol = 2)
for (k in 5:7) {
j <- which.max(df_sum_tidy[k, -1])  # column with largest value
fontface_matrix[k, j] <- "bold"
}
blue_theme <- ttheme_default(
core = list(fg_params = list(
fontface =as.vector(fontface_matrix)),
bg_params = list(fill=as.vector(bg_table1),
col = as.vector(border_matrix),lwd  = as.vector(lwd_matrix))),
#,colhead = list(bg_params = list(fill = "blue", col = NA))
colhead = list(
fg_params = list(fontface = "bold"),         # bold headers
bg_params = list(fill = "white", col = "white")  # white fill + black border
)
)
table1 <- tableGrob(df_sum_tidy[,-1], rows = c("(1) DLT rate", "(2) Response rate", "(3a) Sufficient intensity rate", "(3b) Expected symptom bother", expression(atop(bold("Rank prioritising DLTs:"), "Probability dose selected `best`:")),
expression(atop(bold("Rank with intermediate ties:"), "Probability dose selected `best`:")), expression(atop(bold("Rank prioritising response:"), "Probability dose selected `best`:"))),theme = blue_theme)
p <- ggplot() + xlim(0, 4) + ylim(0, 4) + theme_void()
fig2<- p + annotation_custom(table1, xmin = 0, xmax = 4, ymin = 0, ymax = 4) +ggtitle(paste0("Scenario ",i))+
theme(
plot.title = element_text(
hjust = 0.2,
vjust = 1,
size = 16,
face = "bold"
),
plot.margin = unit(c(2, 1, 1, 1), "cm")
)
fig2
fig<-plot_grid(fig2, density, ncol = 2, rel_widths = c(1, 1.3))
pdf(file.path(paste0("sim_results/scenario", i), paste0("plot_scenario", i, ".pdf")), width=10, height=5)
tryCatch({
print(fig)
}, finally = {
dev.off()
})
assign(paste0("figure", i), fig)
}
pdf(file.path(paste0("figures"), paste0("simulation_figure.pdf")), width=10, height=18)
print(plot_grid(figure1, figure2, figure3, figure4, ncol = 1))
dev.off()
highlight_cells <- function(df, skip_bottom_n = 3, small_better_rows = integer(0), color = "lightgreen") {
n_rows <- nrow(df)
n_cols <- ncol(df)
bg <- matrix("white", nrow = n_rows, ncol = n_cols)
for (i in 1:n_rows) {
if (i > (n_rows - skip_bottom_n)) next
if (i %in% small_better_rows) {
# find the minimum value in the row
best_value <- min(df[i, ])
} else {
# find the maximum value in the row
best_value <- max(df[i, ])
}
# find all columns with that best value and color them
best_cols <- which(df[i, ] == best_value)
bg[i, best_cols] <- color
}
return(bg)
}
border_colors <- c("black", "black", "black", "black", "red3", "darkgoldenrod3", "steelblue3")
bg_table1 <- highlight_cells(df_sum_tidy[,-1], small_better_rows = c(1,4))
# Expand to a matrix to match table shape
border_matrix <- matrix(rep(border_colors, each = 2), nrow = 7, ncol = 2, byrow = TRUE)
lwd_matrix <- matrix(1, nrow = 7, ncol = 2)
lwd_matrix[5:7, ] <- 4
fontface_matrix <- matrix("plain", nrow = 7, ncol = 2)
for (k in 5:7) {
j <- which.max(df_sum_tidy[k, -1])  # column with largest value
fontface_matrix[k, j] <- "bold"
}
blue_theme <- ttheme_default(
core = list(fg_params = list(
fontface =as.vector(fontface_matrix)),
bg_params = list(fill=as.vector(bg_table1),
col = as.vector(border_matrix),lwd  = as.vector(lwd_matrix))),
#,colhead = list(bg_params = list(fill = "blue", col = NA))
colhead = list(
fg_params = list(fontface = "bold"),         # bold headers
bg_params = list(fill = "white", col = "white")  # white fill + black border
)
)
table1 <- tableGrob(df_sum_tidy[,-1], rows = c("(1) DLT rate", "(2) Response rate", "(3a) Sufficient intensity rate", "(3b) Expected symptom bother", expression(atop(bold("Rank prioritising DLTs:"), "Probability dose selected `best`:")),
expression(atop(bold("Rank with intermediate ties:"), "Probability dose selected `best`:")), expression(atop(bold("Rank prioritising response:"), "Probability dose selected `best`:"))),theme = blue_theme)
p <- ggplot() + xlim(0, 4) + ylim(0, 4) + theme_void()
fig2<- p + annotation_custom(table1, xmin = 0, xmax = 4, ymin = 0, ymax = 4) +ggtitle(paste0("Scenario ",i))+
theme(
plot.title = element_text(
hjust = 0.2,
vjust = 1,
size = 16,
face = "bold"
),
plot.margin = unit(c(2, 1, 1, 1), "cm")
)
fig2
setwd("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio")
source("functions.R")
source("figure_sourcefile.R")
set.seed(11600)
#fixed for simulations
n.sim<-5000
n.sample_vec<- c(30,30)
correlation_pro_exp<- -0.6
correlation_pro_dlt<- 0.5
exposure_threshold<- 0.8
#vary across simulations
mat_dlt_rate<-t(matrix(c(0.27,0.42,0.27,0.27,0.2,0.45, 0.27, 0.27), nrow=2))
mat_efficacy_rate<-t(matrix(c(0.38, 0.38, 0.38, 0.60, 0.2, 0.6, 0.38, 0.38), nrow=2))
mat_dlt_efficacy<-t(matrix(c(0.3, 0.3, 0.3, 0.5, 0.1, 0.5, 0.3, 0.3), nrow=2))
mat_exposure_shape<- t(matrix(rep(9, times=8), nrow=2))
mat_exposure_rate<-t(matrix(c(1,2,1,1,1,2,1,2), nrow=2))
pro_scenario <- list()
pro_scenario[[1]]<-matrix(c(0.16, 0.23, 0.37, 0.18, 0.07, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[2]]<-matrix(c(0.059, 0.029, 0.265, 0.382, 0.265, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[3]]<-matrix(c(0.059, 0.029, 0.265, 0.382, 0.265, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
pro_scenario[[4]]<-matrix(c(0.16, 0.23, 0.37, 0.18, 0.07, 0.059, 0.029, 0.265, 0.382, 0.265), nrow=2, byrow=TRUE)
fact_score <- abind(pro_scenario, along = 3)
for (i in 1:4){
vec_dlt_rate<- mat_dlt_rate[i,]
overall_efficacy<- mat_efficacy_rate[i,]
dlt_efficacy<- mat_dlt_efficacy[i,]
vec_exposure_shape<- mat_exposure_shape[i,]
vec_exposure_rate<- mat_exposure_rate[i,]
mat_fact<- fact_score[,,i]
sim_input <- list(
n.sim,
n.sample_vec,
correlation_pro_exp,
correlation_pro_dlt,
exposure_threshold,
vec_dlt_rate,
overall_efficacy,
dlt_efficacy,
vec_exposure_shape,
vec_exposure_rate,
mat_fact
)
saveRDS(sim_input, file = paste0("sim_results/scenario", i,"/simulation_inputs_scenario",i))
test<-replicate(n.sim,
analysis(n.sample_vec, vec_dlt_rate, overall_efficacy, dlt_efficacy , correlation_pro_exp, correlation_pro_dlt,
vec_exposure_shape, vec_exposure_rate, mat_fact,  exposure_threshold),
simplify = FALSE)
response_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["response"]])))
dlt_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["dlt"]])))
tie_priority <-  do.call(rbind, lapply(test, function(x) as.numeric(x[["tie"]])))
colnames(response_priority)<- c("doseA", "doseB", "tie")
colnames(dlt_priority)<- c("doseA", "doseB", "tie")
colnames(tie_priority)<- c("doseA", "doseB", "tie")
write.csv(response_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_response_priority_scenario", i, ".csv")))
write.csv(dlt_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_dlt_priority_scenario", i, ".csv")))
write.csv(tie_priority, file = file.path(paste0("sim_results/scenario", i), paste0("wins_tie_priority_scenario", i, ".csv")))
wr_response_priority<-sapply(1:n.sim, function (k) response_priority[k,1]/response_priority[k,2])
wr_dlt_priority<-sapply(1:n.sim, function (k) dlt_priority[k,1]/dlt_priority[k,2])
wr_tie_priority<-sapply(1:n.sim, function (k) tie_priority[k,1]/tie_priority[k,2])
wr<-cbind(wr_response_priority,wr_dlt_priority,wr_tie_priority)
write.csv(wr, file = file.path(paste0("sim_results/scenario", i), paste0("wr_scenario", i, ".csv")))
#######CREATE FIGURE ########
df <- bind_rows(
data.frame(value = wr_response_priority, type = "response_priority"),
data.frame(value = wr_dlt_priority, type = "dlt_priority"),
data.frame(value = wr_tie_priority, type = "tie_priority"),
)
empirical<- df%>%group_by(type)%>%summarise(mean(value<=1))
colnames(empirical)<- c("priority", "prob_dose_a")
empirical[1,1]<- "dlt"
empirical[2,1]<- "response"
empirical[3,1]<- "tie"
# Plot densities
density<-ggplot(df, aes(x = value, color = type)) +
geom_density(size = 1.2) +  # Density lines
xlim(0, 4) +
labs(title = " ", x = "Win Ratio", y = "Density", colour="Rank") +
theme_minimal() +
geom_vline(xintercept = 1, linetype = "dotted", color = "black", size = 0.8)+
scale_color_manual(values = c("response_priority" = "steelblue3", "dlt_priority" = "red3", "tie_priority"="darkgoldenrod2"))+
theme(
legend.position = "none",
legend.background = element_rect(fill = alpha("white", 0.6)),  # semi-transparent background
legend.title = element_text(face = "bold")
)+coord_cartesian(clip = "off")+
annotate("segment", x = 1, xend = 0, y = -0.15, yend = -0.15,
arrow = arrow(length = unit(0.2, "cm")), color = "black") +
annotate("text", x = 0.2, y = -0.08, label = "Win ratio favours Dose A", hjust = 0.5) +
annotate("segment", x = 1, xend = 4, y = -0.15, yend = -0.15,
arrow = arrow(length = unit(0.2, "cm")), color = "black") +
annotate("text", x = 1.8, y = -0.08, label = "Win ratio favours Dose B", hjust = 0.5)+ expand_limits(y = -0.3)
density
df_sum <- data.frame(
dose = c("Dose A", "Dose B"),
prob_no_DLT = round(vec_dlt_rate,2),
prob_response = round(overall_efficacy,2),
prob_inten = round(c(1-pbeta(0.8, vec_exposure_shape[1], vec_exposure_rate[1]),
1-pbeta(0.8, vec_exposure_shape[2], vec_exposure_rate[2])),2),
exp_fact = round(c(sum(mat_fact[1,]*(1:5)), sum(mat_fact[2,]*(1:5))),2),
dlt = round(c(empirical$prob_dose_a[1], 1-empirical$prob_dose_a[1]),2),
tie = round(c(empirical$prob_dose_a[3], 1-empirical$prob_dose_a[3]),2),
response = round(c(empirical$prob_dose_a[2], 1-empirical$prob_dose_a[2]),2)
)
df_sum_tidy <- df_sum %>%
pivot_longer(-dose, names_to = "Metric", values_to = "Value") %>%
pivot_wider(names_from = dose, values_from = Value)
bg_table1 <- highlight_cells(df_sum_tidy[,-1], small_better_rows = c(1,4))
# Expand to a matrix to match table shape
border_matrix <- matrix(rep(border_colors, each = 2), nrow = 7, ncol = 2, byrow = TRUE)
lwd_matrix <- matrix(1, nrow = 7, ncol = 2)
lwd_matrix[5:7, ] <- 4
fontface_matrix <- matrix("plain", nrow = 7, ncol = 2)
for (k in 5:7) {
j <- which.max(df_sum_tidy[k, -1])  # column with largest value
fontface_matrix[k, j] <- "bold"
}
blue_theme <- ttheme_default(
core = list(fg_params = list(
fontface =as.vector(fontface_matrix)),
bg_params = list(fill=as.vector(bg_table1),
col = as.vector(border_matrix),lwd  = as.vector(lwd_matrix))),
#,colhead = list(bg_params = list(fill = "blue", col = NA))
colhead = list(
fg_params = list(fontface = "bold"),         # bold headers
bg_params = list(fill = "white", col = "white")  # white fill + black border
)
)
table1 <- tableGrob(df_sum_tidy[,-1], rows = c("(1) DLT rate", "(2) Response rate", "(3a) Sufficient intensity rate", "(3b) Expected symptom bother", expression(atop(bold("Rank prioritising DLTs:"), "Probability dose selected `best`:")),
expression(atop(bold("Rank with intermediate ties:"), "Probability dose selected `best`:")), expression(atop(bold("Rank prioritising response:"), "Probability dose selected `best`:"))),theme = blue_theme)
p <- ggplot() + xlim(0, 4) + ylim(0, 4) + theme_void()
fig2<- p + annotation_custom(table1, xmin = 0, xmax = 4, ymin = 0, ymax = 4) +ggtitle(paste0("Scenario ",i))+
theme(
plot.title = element_text(
hjust = 0.2,
vjust = 1,
size = 16,
face = "bold"
),
plot.margin = unit(c(2, 1, 1, 1), "cm")
)
fig<-plot_grid(fig2, density, ncol = 2, rel_widths = c(1, 1.3))
pdf(file.path(paste0("sim_results/scenario", i), paste0("plot_scenario", i, ".pdf")), width=10, height=5)
tryCatch({
print(fig)
}, finally = {
dev.off()
})
assign(paste0("figure", i), fig)
}
pdf(file.path(paste0("figures"), paste0("simulation_figure.pdf")), width=10, height=18)
print(plot_grid(figure1, figure2, figure3, figure4, ncol = 1))
dev.off()
setwd("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results")
#scenario1
dlt_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_dlt_priority_scenario1.csv")[,-1]
response_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_response_priority_scenario1.csv")[,-1]
tie_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_tie_priority_scenario1.csv")[,-1]
sc1<-rbind(c("DLT", colMeans(dlt_priority_scenario1)),
c("ties", colMeans(tie_priority_scenario1)),
c("response",colMeans(response_priority_scenario1)))
#scenario2
dlt_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_dlt_priority_scenario2.csv")[,-1]
response_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_response_priority_scenario2.csv")[,-1]
tie_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_tie_priority_scenario2.csv")[,-1]
sc2<-rbind(c("DLT", colMeans(dlt_priority_scenario2)),
c("ties", colMeans(tie_priority_scenario2)),
c("response",colMeans(response_priority_scenario2)))
#scenario3
dlt_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_dlt_priority_scenario3.csv")[,-1]
response_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_response_priority_scenario3.csv")[,-1]
tie_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_tie_priority_scenario3.csv")[,-1]
sc3<-rbind(c("DLT", colMeans(dlt_priority_scenario3)),
c("ties", colMeans(tie_priority_scenario3)),
c("response",colMeans(response_priority_scenario3)))
#scenario4
dlt_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_dlt_priority_scenario4.csv")[,-1]
response_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_response_priority_scenario4.csv")[,-1]
tie_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_tie_priority_scenario4.csv")[,-1]
sc4<-rbind(c("DLT", colMeans(dlt_priority_scenario4)),
c("ties", colMeans(tie_priority_scenario4)),
c("response",colMeans(response_priority_scenario4)))
write.csv(rbind(sc1, sc2, sc3, sc4), "mean_winlosstie.csv")
setwd("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results")
dlt_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_dlt_priority_scenario1.csv")[,-1]
response_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_response_priority_scenario1.csv")[,-1]
tie_priority_scenario1 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario1/wins_tie_priority_scenario1.csv")[,-1]
sc1<-rbind(c("DLT", colMeans(dlt_priority_scenario1)),
c("ties", colMeans(tie_priority_scenario1)),
c("response",colMeans(response_priority_scenario1)))
#scenario2
dlt_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_dlt_priority_scenario2.csv")[,-1]
response_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_response_priority_scenario2.csv")[,-1]
tie_priority_scenario2 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario2/wins_tie_priority_scenario2.csv")[,-1]
sc2<-rbind(c("DLT", colMeans(dlt_priority_scenario2)),
c("ties", colMeans(tie_priority_scenario2)),
c("response",colMeans(response_priority_scenario2)))
#scenario3
dlt_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_dlt_priority_scenario3.csv")[,-1]
response_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_response_priority_scenario3.csv")[,-1]
tie_priority_scenario3 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario3/wins_tie_priority_scenario3.csv")[,-1]
sc3<-rbind(c("DLT", colMeans(dlt_priority_scenario3)),
c("ties", colMeans(tie_priority_scenario3)),
c("response",colMeans(response_priority_scenario3)))
#scenario4
dlt_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_dlt_priority_scenario4.csv")[,-1]
response_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_response_priority_scenario4.csv")[,-1]
tie_priority_scenario4 <- read.csv("C:/Users/ealger/OneDrive - The Institute of Cancer Research/M/PhD/Trial Designs/win_ratio/sim_results/scenario4/wins_tie_priority_scenario4.csv")[,-1]
sc4<-rbind(c("DLT", colMeans(dlt_priority_scenario4)),
c("ties", colMeans(tie_priority_scenario4)),
c("response",colMeans(response_priority_scenario4)))
write.csv(rbind(sc1, sc2, sc3, sc4), "mean_winlosstie.csv")
write.csv(rbind(sc1, sc2, sc3, sc4), "mean_winlosstie.csv")
